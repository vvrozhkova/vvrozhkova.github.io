{"hash":"7ce6058f470c3851afaa44882541a7f3d1089ffc","data":{"tag":{"title":"selenium","path":"/tag/selenium/","belongsTo":{"totalCount":3,"pageInfo":{"totalPages":1,"currentPage":1},"edges":[{"node":{"id":"082b43d0f2853fd3012326e26df2377d","title":"Selenide","content":"\n## Настройка таймаута\n\nВыполняется через System.setProperty();\n\n```java\nmvn -Dselenide.timeout=8000\n```\n\n## Коллекции\n\n$ - возвращает первый элемент\n$$ - возвращает список\n\n```java\n$$(\".error\").shouldHave(size(3));\n```\n\n```java\n$$(\"#employees tbody tr\").shouldHave(\n  tests(\n    \"John Belushi\",\n    \"Bruce Willis\",\n    \"John Malkovich\"\n  )\n);\n```\n\n## Коллекции: фильтрации\n```java\n$$(\"#employees tbody tr\")\n  .filter(visible)\n  .shouldHave(size(4));\n```\n\n## Поиск элементов\n\n```java\n$(\"#loginBtn\") = $(By.id(\"loginBtn\"));\n$(\".active\") = $(By.className(\"active\"));\n$(\"[name=username]\") = $(By.name(\"username\"));\n$x(\"//div//h1\") = $(By.xpath(\"//div//h1\"));\n```\n\n### Поиск по атрибутам\n```java\n$(by(\"type\", \"checkbox\"));\n$(by(\"readonly\", \"readonly\"));\n$(byTitle(\"Login form\"));\n$(byValue(\"Alert button\"));\n$(by(\"data-test-id\", \"alert-button\"));\n\n$(byText(\"Hello\"));\n$(withText(\"ello\"));\n```\n\n## Открываем браузер\n\n```java\nopen(\"url\");\n```\n\n## Ввести значение в поле\n\n```java\n$(By.name(\"user.name\")).setValue(\"john\");\n```\n\n## Кликнуть мышью один раз\n\n```java\n$(\"#submit\").click();\n```\n\n## Выполнить проверку по тексту элемента\n\n```java\n$(\".menu\").shouldHave(text(\"Hello, John!\"));\n```\n\n## Page Object\n\n```java\npublic class GooglePage {\n  public void search(String queue){\n    $(By.name(\"q\"))\n        .val(queue)\n        .pressEnter();\n  }\n}\n\nМожно вынести локатор в поле класса:\n\n```java\npublic class GooglePage {\n  private By query = By.name(\"q\");\n\n  public void search(String queue){\n    $(query)\n        .val(queue)\n        .pressEnter();\n  }\n}\n```\n\n```java\n@Test{\n  var page = new GooglePage();\n}\n```\n\nМожно вынести в поле весь элемент, но тогда нужно инициализировать класс страницы через специальный Factory метод.\n\n```java\npublic class GooglePage {\n  private SelenideElement query = $(By.name(\"q\"));\n\n  public void search(String queue){\n    query\n        .val(queue)\n        .pressEnter();\n  }\n}\n```\n\n```java\n@Test{\n  var page = page(GooglePage.class);\n}\n```\n\n## Аналог Yandex HtmlElements\n\n```java\npublic class HtmlElementsPage {\n  SelenideElement container = $(\"...\");\n  SelenideElement username = container.$(\"...\");\n  SelenideElement password = container.$(\"...\");\n\n  public void login(String un, String pwd){\n    username.val(un);\n    password.val(pwd);\n  }\n}\n```\nИли другой вариант:\n\n```java\npublic class HtmlElementsPage {\n  @FindBy(id=\"status\")\n  StatusBlock status;\n}\nclass StatusBlock extends ElementsContainer {\n  @FindBy(className=\"username\")\n  SelenideElement username;\n\n  @FindBy(className = \"password\")\n  SelenideElement password;\n}\n```\n\n## Навигация по DOM'у\n\n```java\n$.parent()\n$.closest(\"table\")\n```\n\n```java\n$(\"table td[data-foo='bar']\")\n.closest(\"table\")\n.find(\"tr\", 4)\n.find(byText(\"text\"));\n```\n\n## Задать тип браузера для запуска\n\n```java\njava -Dselenide.browser=chrome\njava -Dselenide.browser=firefox\njava -Dselenide.browser=ie\njava -Dselenide.browser=cy.test.MyWebDriver\n```\n\nЭти параметры удобно использовать когда в gradle.build мы создаем разные tasks или в pom.xml создаем разные profile\n\n```groovy\ntask chrome(type: Test){\n  systemProperties['selenide.browser'] = 'chrome'\n}\n\ntask firefox(type: Test){\n  systemProperties['selenide.browser'] = 'firefox'\n}\n```\n\n**Jenkins**\nJob 1: ./gradlew chrome  \nJob 2: ./gradlew firefox\n\nили можно задать браузер прямо в коде\n\n```java\n@Before\npublic void setUp(){\n  Configuration.browser = \"chrome\";\n  // or Configuration.browser = \"firefox\";\n  // or Configuration.browser = \"cy.MyWebDriver\";\n}\n```\n\n## Задать свой WebDriver (со своими настройками)\n\n- setWebDriver (не рекомендуется)  \nПри использовании этого способа, нужно самому закрывать драйвер.\n\n```java\n@Before\npublic void setUp(){\n  this.browser = new ChromeDriver(........);\n  WebDriverRunner.setWebDriver(browser);\n}\n```\n\n- WebDriverProvider  \nНужно только открыть закрывать и другие действия Selenide делает сам.\n\n```java\n@Before\npublic void setUp(){\n  Configuration.browser = MyWDProvider.class.getName();\n  open(\"https://google.com\");\n}\n\nstatic class MyWDProvider implements WebDriverProvider{\n  @Override\n  public WebDriver createDriver(DesiredCapabilities capabilities){\n    ChromeOptions options = new ChromeOptions();\n    options.setHeadless(true);\n    options.setArguments(\"--proxy-bypass-list=<-loopback>\");\n    options.merge(desiredCapabilities);\n    return new ChromeDriver(options);\n  }\n}\n```\n\n## Два браузера в одном тесте\n\n```java\nvar b1 = new SelenideDriver();\nb1.open(\"http://some.site.com\");\nb1.$(\"#username\").val(\"petja\").pressEnter();\nb1.$(\"#name\").shouldHave(text(\"Hello, Petja!\"));\n\nvar b2 = new SelenideDriver();\nb2.open(\"http://some.site.com/admin\");\nb2.$(\".block[data-username='petja']\").click();\n\nb1.$(\"#name\").shouldHave(text(\"Goodbye, Petja!\"));\n```\n\nПри вызове браузеров можно также передавать разные настройки:\n\n```java\nvar b1 = new SelenideDriver(\n  new SelenideConfig()\n  .timeout(6000)\n  .browser(\"chrome\")\n  .headless(true)\n);\n\nvar b2 = new SelenideDriver(\n  new SelenideConfig()\n  .timeout(90_000)\n  .browser(\"firefox\")\n  .proxyEnabled(true)\n);\n```\n\n## Прокси\n\n### Загрузка файлов\n\nЕсть два варианта: \n- Configuration.fileDownload = HTTPGET;  \nЕсли файл загружается по ссылке. Включен по умолчанию.\n\n```java\n@Test \npublic void userCanViewTerminalDetailsAsPDF() throws FileNotFoundException { \n  File detailsAsPdf = $(\"#print-pdf\").download(); \n  PDF pdf = new PDF(pdfFile); \n  assertThat(pdf, containsText(\"PP028004\")); \n  assertThat(pdf, containsText(\"Торговый терминал\")); \n  assertThat(pdf, containsTextCaseInsensitive(\"VeriFone VX 810\")); \n} \n```\n\n> Проверить pdf и xls можно с помощью:  \n> - github.com/codeborne/pdf-test  \n> - github.com/codeborne/xls-test\n\n- Configuration.fileDownload = PROXY;\nКогда по клику по элементу начинается загрузка файла.\nSelenide запускает свой прокси-сервер и перехватывает запросы/ответы.\n\nОн умеет: \n- Скачивать файлы \n- Подменять заголовки \n- Инжектить JS код на страницу \n- И т.д. и т.п.\n\nПо умолчанию он отключен так как если тесты запускаются на машине A а браузер на машине B и с машины B не видна машина A, то могут быть проблемы.\n\n```java\n@Before \npublic void setUp() { \n  Configuration.proxyEnabled = true; \n  open(\"https://google.com\"); \n}\n\n@Test \nvoid canAddInterceptorsToProxyServer() { \n  SelenideProxyServer proxy = getSelenideProxy(); \n\n  proxy.addRequestFilter(\"proxy-usages.request\", (request, \n  contents, messageInfo) -> { \n    String url = messageInfo.getUrl(); \n    log(url + \"nn\" + contents.getTextContents()); \n    return null; \n    });\n}\n```\n\n## Параллелизация\n\nПроблемы которые могут возникать:\n- Статические переменные \n- Одновременный доступ к данным \n- синхронизация \n- И т.д.\n\nЛучше запускать тесты в N процессов(forks).\n\n### Maven\n\npom.xml: \n\n```xml\n<plugin> \n  <groupId>org.apache.maven.plugins</groupId> \n  <artifactId>maven-surefire-plugin</artifactId> \n  <configuration> \n    <forkCount>3</forkCount> \n    <reuseForks>true</reuseForks> \n  </configuration> \n</plugin> \n```\n\n### Gradle\n\n```groovy\ntest {\n  maxParallelForks = 5\n}\n```\n\n## Трюки с JavaScript\n\n### Выбрать дату\n\n```java\nvoid setDateByName(String name, String date) { \n  executeJavaScript(\n    String.format(\"$('[name=\\\"%s\\\"]').val('%s')\", \n    name, date)); \n} \n\n@Test { \n  setDateByName(\"recurrent.startDate\", \"16.01.2009\"); \n}\n```\n\n### Выбрать опцию в bootstrap select\n\n```java\nvoid selectBS(WebElement select, String value) { \n  executeJavaScript( \n    \"$(arguments[0]).val(arguments[1]).trigger('change')\", \n    select, value); \n} \n\n@Test { \n  selectBS($(By.name(\"operationCode\")), \"11100\"); \n}\n```\n\n### Слайдер\n\n```java\nvoid setMaxYearlyFee(int value) { \n  executeJavaScript( \n    \"$('#sld').data('slider').value[0] = arguments[0];\" + \n    \"$('#sld').triggerHandler('slide');\" \n    ); \n} \n\n@Test { \n  setMaxYearlyFee(100); \n}\n```\n\n### Отключить Confirm окно\n\n```java\npublic static void mockConfirm() { \n  executeJavaScript( \n    \"window.confirm = function() {return true;};\" \n  ); \n}\n```\n\n### Контакты в мобильном \n\nЭмуляция функции.\n\n```java\nprivate void mockCordovaContactsAPI(String number) { \n  executeJavaScript( \n    \"window.plugins = {\" + \n    \" contactNumberPicker: { \" + \n    \" pick: function(callback) {\" + \n    \" callback({\" + \n    \" phoneNumber:\\\"\" + number + \"\\\"\"\"\n    });}}}\"); \n} \n    \n@Test { \n  mockCordovaContactsAPI(\"+79110080075\"); \n}\n```\n\n### Кол-во видимых элементов \n\nСелениум не умеет искать по jquery локатору.\n\n```java\n@Test { \n  $$(\".offer:visible\").shouldHave(size(3)); \n} \n@Test {\n  $$(\".offer\").filter(visible) .shouldHave(size(3)); \n} // это может быть медленно если на странице много элементов\n```\n\nЧерез JavaScript в разы быстрее:\n\n```java\nint sizeOf(String cssSelector) { \n  Number count = executeJavaScript( \n    \"return $(arguments[0]).length\", cssSelector); \n    return count.intValue(); \n} \n@Test { \n  assertEquals(1, sizeOf(\".offer:visible\")); \n}\n```\n\n### Из списка элементов исключить другой список \n\nЗадача: найти страны из excel и страны на странице и найти те которые есть на странице но нет в excel.\n\n```java\nList<String> страныИзЭксельки = ...; \nList<String> страныСоСтраницы = $$(“td:nth-child(3)”) \n  .excludeWith(text(“text”)) \n  .stream() \n  .map(el -> el.getText()) \n  .collect(toList()); // Это м.б. медленно :(\n```\n\n```java\nList<String> страныИзЭксельки = ...; \nList<String> страныСоСтраницы = executeJavascript( \n  \"return Array.from(\" + \n  \" document.querySelectorAll('td:nth-child(3)')\" \n  + \").map(x => x.textContent)\"\n); // А вот это быстро\n```\n\n### fast set value\n\nПроблема: \n\n1. $.sendKeys() медленный \n2. Иногда $.sendKeys() не работает:  \n  a. Элемент невидимый   \n  b. Маска на поле  \n  c. Какой-нибудь хитрый JS  \n  d. Какой-нибудь компонент типа DatePicker \n  \nНа помощь приходит JavaScript!\n\nРежим “fast set value” - значение не вводится по одному символу, а вставляется сразу через JS.\n\nДля того чтобы включить этот режим нужно:\n\nУстановить системную переменную:\n```\nmvn -Dselenide.fastSetValue=true \n```\nили\n\nВызвать метод:\n```java\n@Before public void setUp() { \n  Configuration.fastSetValue = true; \n} \n```\n\nВ этом случае setValue функция начинает работать через JS.\n\nТакде в любой момент можно выбирать:\n- $.setValue(“john”) - быстро \n- $.sendKeys(“john”) - если быстро никак \n\n\n## Самопальные команды\n\n### Слайдер \n\nИмеем функцию для установки значения слайдера:\n\n```java\n@Test { \n  setMaxYearlyFee($(“#slider”), 100); \n}\n\nvoid setMaxYearlyFee(WebElement slider, int value) { \n  executeJavaScript(...); \n} \n```\n\nНо вместо этой записи иногда удобнее иметь такую:\n```java\n@Test { \n  $(“#slider”).setMaxYearlyFee(100); \n} \n```\nА ещё круче вот так: \n\n```java\n@Test {\n  $(“#slider”) \n  .setMaxYearlyFee(100) \n  .setMinYearlyFee(15) \n  .selectFee(50) \n} \n```\n\nТак можно в Kotlin и Groovy Но не в Java!\n\nНо можно так: \n```java\n@Test { \n  $(“#slider”) \n  .execute(setMaxYearlyFee(100)) \n  .execute(setMinYearlyFee(15)) \n  .execute(selectFee(50)) \n} \n\nCommand<SelenideElement> setMaxYearlyFee(int fee) { \n  return (proxy, locator, args) -> { \n    executeJavaScript(\".... \" + fee); \n    return proxy; \n  }; \n} \n```\n\nСм. https://ru.selenide.org/2019/09/02/selenide-5.3.0/\n\n## Selenide и мобильники\n### Selenide для мобильников (Appium) \n\nМожно без аннотаций: \n\n```java\n@Test public void mobileCalculator() { \n  $(By.name(\"2\")).click(); \n  $(By.name(\"+\")).click(); \n  $(By.name(\"4\")).click(); \n  $(By.name(\"=\")).click(); \n  $(By.className(\"android.widget.EditText\")) \n  .shouldHave(text(\"6\")); \n} \n```\nhttps://github.com/selenide-examples/selenide-appium\n\n\n### Пэдж обжекты и Appium \n\nА можно и с аннотациями:\n\n```java\nclass MobileCalculatorPage { \n  @AndroidFindBy(id = \"op_add\") \n  @iOSFindBy(id = “op_add”); \n  SelenideElement plus; \n} \n```\nhttps://github.com/selenide/selenide-appium\n\n### Test setup\n\nСтандартного браузера нет поэтому нужно задавать класс своего драйвера.\nИспользуется для открытия приложения метод `open()` без параметра.\n\n```java\npublic class CalculatorTest {\n  @Before\n  public void setUp(){\n    Configuration.startMaximized = false;\n    Configuration.browserSize = null;\n    Configuration.browser = MyAndroidDriver.class.getName();\n    open();\n  }\n}\n```\n\n#### Android\n\n```java\npublic class MyAndroidDriver implements WebDriverProvider {\n  @Override\n  public WebDriver createDriver(DesiredCapabilities caps){\n    caps.setCapabilities(\"version\" ,\"4.4.2\");\n    caps.setCapabilities(\"automationName\" ,\"Appium\");\n    caps.setCapabilities(\"platformName\" ,\"Android\");\n    caps.setCapabilities(\"deviceName\" ,\"0123456789ABCDEF\");\n    caps.setCapabilities(\"appPackage\" ,\"com.android.calculator2\"); // т.к. калькулятор приложение Android по умолчанию, то достаточно указать только package\n    caps.setCapabilities(\"appActivity\" ,\"com.android.calculator2.Calculator\"); // запустится сразу указанное Activity\n\n    return new AndroidDriver(new URL(\"http://127.0.0.1:4723/wd/hub\"), caps); // URL запущенного Appium Server\n  }\n}\n```\n\n#### iOS\n\n```java\npublic class MyIOSDriver implements WebDriverProvider {\n  @Override\n  public WebDriver createDriver(DesiredCapabilities caps){\n    caps.setCapabilities(\"platformName\" ,\"iOS\");\n    caps.setCapabilities(\"deviceName\" ,\"iPhone 11\");\n    caps.setCapabilities(\"platformVersion\" ,\"13.0\");\n    caps.setCapabilities(\"app\", resourcePath(\"apks/Wikipedia.app\"));\n    caps.setCapabilities(MobileCapabilityType.NEW_COMMAND_TIMEOUT, \"16\");\n    caps.setCapabilities(\"autoAcceptAlerts\", true);\n\n    return new IOSDriver(\"http://127.0.0.1:4723/wd/hub\", caps); // URL запущенного Appium Server\n  }\n}\n```\n\n### Универсальный Page Object (для iOS, Android, Web)\n\n```java\nclass MobileCalculatorPage {\n  @FindBy(id=\"op_add\")\n  @AndroidFindBy(id=\"op-add\")\n  @iOSFindBy(id=\"operandAdd\");\n  private SelenideElement plus;\n}\n```\n\nдля инициализации класса для web используется метод page, для mobile метод screen\n\n```java\nCalculatorPage calculator = page(CalculatorPage.class);\n```\n\n```java\nCalculatorPage calculator = screen(CalculatorPage.class);\ncalculator.number2.click();\ncalculator.plus.click();\ncalculator.number4.click();\ncalculator.equal.click();\ncalculator.result.shouldHave(text(\"6\"));\n```","date":"2022-06-19T00:00:00.000Z","path":"/selenide/","icon":"fas fa-robot","image":"null","order":null,"category":{"title":"automation","path":"/category/automation/"},"tags":[{"title":"selenium","path":"/tag/selenium/"},{"title":"selenide","path":"/tag/selenide/"}],"headings":[{"value":"Настройка таймаута","anchor":"#настройка-таймаута"},{"value":"Коллекции","anchor":"#коллекции"},{"value":"Коллекции: фильтрации","anchor":"#коллекции-фильтрации"},{"value":"Поиск элементов","anchor":"#поиск-элементов"},{"value":"Открываем браузер","anchor":"#открываем-браузер"},{"value":"Ввести значение в поле","anchor":"#ввести-значение-в-поле"},{"value":"Кликнуть мышью один раз","anchor":"#кликнуть-мышью-один-раз"},{"value":"Выполнить проверку по тексту элемента","anchor":"#выполнить-проверку-по-тексту-элемента"},{"value":"Page Object","anchor":"#page-object"},{"value":"Аналог Yandex HtmlElements","anchor":"#аналог-yandex-htmlelements"},{"value":"Навигация по DOM'у","anchor":"#навигация-по-domу"},{"value":"Задать тип браузера для запуска","anchor":"#задать-тип-браузера-для-запуска"},{"value":"Задать свой WebDriver (со своими настройками)","anchor":"#задать-свой-webdriver-со-своими-настройками"},{"value":"Два браузера в одном тесте","anchor":"#два-браузера-в-одном-тесте"},{"value":"Прокси","anchor":"#прокси"},{"value":"Параллелизация","anchor":"#параллелизация"},{"value":"Трюки с JavaScript","anchor":"#трюки-с-javascript"},{"value":"Самопальные команды","anchor":"#самопальные-команды"},{"value":"Selenide и мобильники","anchor":"#selenide-и-мобильники"}]}},{"node":{"id":"361bd553ebc8936c1e1b3b66d6d0a824","title":"Подходы Badoo","content":"","date":"2022-06-19T00:00:00.000Z","path":"/podhody-badoo/","icon":"fas fa-robot","image":"null","order":null,"category":{"title":"mobile","path":"/category/mobile/"},"tags":[{"title":"selenium","path":"/tag/selenium/"},{"title":"mobile","path":"/tag/mobile/"}],"headings":[]}},{"node":{"id":"bc7ff23838128e5ec3fd7300d34483d6","title":"Selenium & Selenide","content":"\n\n✅ [QA Fest: Selenide для профи - Андрей Солнцев. QA Fest 2019](https://youtu.be/be_cTwayRQc)\n\n❌ [Simple Automation: Автоматизация для QA: Selenide](https://youtu.be/xknQcm6H87M)\n\n❌ [Hillel IT School: Selenide: tips and tricks](https://youtu.be/5WxlKf_EFII)\n\n❌ [Heisenbug: Алексей Виноградов — Selenide Брандашмыг — интерактивное путешествие по дорогам библиотеки](https://youtu.be/3J6mX98TSjk)\n\n❌ [Heisenbug: Алексей Виноградов, Андрей Солнцев – Selenide Puzzlers](https://youtu.be/y-ZyxTWHH08)\n\n❌ [comaqa: Selenide 2019 - Quo vadis? Новинки и малоизвестные функции библиотеки. Алексей Виноградов](https://youtu.be/U5lpTH-FwqE)\n\n❌ [Somov Studio: Применение Cucumber & Selenide в автоматизации тестирования](https://youtu.be/s33NCtGiVFM)\n\n❌ [DEVCLUB.EU: 2017.12.29 Андрей Солнцев - Selenide Puzzlers](https://youtu.be/LQSrhmzXpHM)\n\n❌ [comaqa:Selenide (Selenium WebDriver + Java): используем listener-ы, Андрей Стахиевич](https://youtu.be/yQa47hx53Zc)\n\n## Как начать проект автоматизации с Selenide\n\nhttps://www.youtube.com/watch?v=1aq4gYflEho\n\nhttps://www.youtube.com/watch?v=pbvJ8rmh7Ws\n\nhttps://www.youtube.com/watch?v=h254Tccxgq4\n\nhttps://www.youtube.com/watch?v=WETyt87o_R4","date":"2022-06-18T00:00:00.000Z","path":"/selenium-and-selenide/","icon":"fas fa-robot","image":"null","order":null,"category":{"title":"automation","path":"/category/automation/"},"tags":[{"title":"selenium","path":"/tag/selenium/"},{"title":"selenide","path":"/tag/selenide/"}],"headings":[{"value":"Как начать проект автоматизации с Selenide","anchor":"#как-начать-проект-автоматизации-с-selenide"}]}}]}},"relatedTag":null},"context":{}}