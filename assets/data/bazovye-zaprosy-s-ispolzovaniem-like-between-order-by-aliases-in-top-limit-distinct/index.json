{"hash":"7783b48d4c1d73fdd39dd248e548414e3a71e66c","data":{"post":{"title":"Базовые запросы с использованием LIKE, BETWEEN, ORDER BY, ALIASES, IN, TOP-LIMIT, DISTINCT","content":"\n## Выборка всех данных из таблицы\n\nДля того чтобы отобрать все данные из таблицы используется SQL запрос следующей структуры:\n\nключевое слово SELECT; \nсимвол « *» ; \nключевое слово FROM; \nимя таблицы.\n\n```sql\nSELECT * FROM book;\n```\n\n## Выборка отдельных столбцов\n\nДля того чтобы отобрать данные из определенных столбцов таблицы используется SQL запрос следующей структуры: \n\nключевое слово SELECT ; \nсписок столбцов таблицы через запятую; \nключевое слово FROM ; \nимя таблицы.\n\n```sql\nSELECT title, amount FROM book;\n```\n\n## AS - Выборка новых столбцов и присвоение им новых имен\n\nДля того чтобы отобрать данные из определенных столбцов таблицы и одновременно задать столбцам новые имена используется SQL запрос следующей структуры: \n\nключевое слово SELECT ; \nимя столбца;\nключевое слово AS ; \nновое название столбца (можно русскими буквами), но это должно быть одно слово, если название состоит из двух слов – соединяйте их подчеркиванием, например, Количество_книг ; \nзапятая; \nимя столбца; \n.... \nключевое слово FROM ; \nимя таблицы.\n\nРезультатом является таблица, в которую включены все данные из указанных после SELECT столбцов исходной таблицы. Каждому столбцу присваивается новое имя, заданное после AS, или столбец получает имя столбца исходной таблицы, если AS отсутствует.\n\n```sql\nSELECT title AS Название, amount \nFROM book;\n```\n\n## Выборка данных, вычисляемые столбцы, математические функции\n\nС помощью SQL запросов можно осуществлять вычисления по каждой строке таблицы с помощью вычисляемого столбца. Для него в списке полей после оператора SELECT указывается выражение и задается имя.\n\nВыражение может включать имена столбцов, константы, знаки операций, встроенные функции.\n\nРезультатом является таблица, в которую включены все данные из указанных после SELECT столбцов, а также новый столбец, в каждой строке которого вычисляется заданное выражение.\n\n```sql\nSELECT title, author, price, amount, \n     price * amount AS total \nFROM book;\n```\n\nВ SQL реализовано множество  математических функций для работы с числовыми данными. В таблице приведены некоторые из них.\n\n|Функция|\tОписание|\tПример|\n|---|---|---|\n|CEILING(x)|\tвозвращает наименьшее целое число, большее или равное x (округляет до целого числа в большую сторону)|CEILING(4.2)=5 CEILING(-5.8)=-5|\n|ROUND(x, k)|округляет значение x до k знаков после запятой, если k не указано – x округляется до целого|ROUND(4.361)=4 ROUND(5.86592,1)=5.9|\n|FLOOR(x)|возвращает наибольшее целое число, меньшее или равное x (округляет до  целого числа в меньшую сторону)|FLOOR(4.2)=4 FLOOR(-5.8)=-6|\n|POWER(x, y)|возведение x в степень y|POWER(3,4)=81.0|\n|SQRT(x)|квадратный корень из x|SQRT(4)=2.0 SQRT(2)=1.41...|\n|DEGREES(x)|конвертирует значение x из радиан в градусы\t|DEGREES(3) = 171.8...|\n|RADIANS(x)|конвертирует значение x из градусов в радианы|\tRADIANS(180)=3.14...|\n|ABS(x)\t|модуль числа x\t|ABS(-1) = 1 ABS(1) = 1|\n|PI()\t|pi = 3.1415926...\t ||\n\nСуществуют разные способы округления чисел. В SQL реализовано математическое округление. Для округления вещественного числа нужно в записи числа выбрать разряд в дробной части, до которого производится округление. Цифра, записанная в выбранном разряде: не меняется, если следующая за ней справа цифра - 0, 1, 2, 3 или 4; увеличивается на единицу, если следующая за ней справа цифра - 5,6,7,8 или 9.\n\n```sql\nSELECT title, \n    price, \n    ROUND((price*18/100)/(1+18/100),2) AS tax, \n    ROUND(price/(1+18/100),2) AS price_tax \nFROM book;\n```\n\n## Выборка данных, вычисляемые столбцы, логические функции\n\nВ SQL реализована возможность заносить в поле значение в зависимости от условия. Для этого используется функция IF:\n\n```IF(логическое_выражение, выражение_1, выражение_2)```\nФункция вычисляет `логическое_выражение`, если оно истина – в поле заносится значение `выражения_1`, в противном случае –  значение `выражения_2`. Все три параметра `IF()` являются обязательными.\n\nДопускается использование вложенных функций, вместо `выражения_1` или `выражения_2` может стоять новая функция `IF`.\n\n```sql\nSELECT title, amount, price, \n    ROUND(IF(amount<4, price*0.5, price*0.7),2) AS sale\nFROM book;\n```\n\n```sql\nSELECT title, amount, price,\n    ROUND(IF(amount < 4, price * 0.5, IF(amount < 11, price * 0.7, price * 0.9)), 2) AS sale,\n    IF(amount < 4, 'скидка 50%', IF(amount < 11, 'скидка 30%', 'скидка 10%')) AS Ваша_скидка\nFROM book;\n```\n\n## Выборка данных по условию\n\nС помощью запросов можно включать в итоговую выборку не все строки исходной таблицы, а только те, которые отвечают некоторому условию. Для этого после указания таблицы, откуда выбираются данные, задается ключевое слово WHERE и логическое выражение, от результата которого зависит будет ли включена строка в выборку или нет. Если условие – истина, то строка(запись)  включается в выборку, если ложь – нет.\n\nЛогическое выражение может включать операторы сравнения (равно «=», не равно «<>», больше «>», меньше «<», больше или равно«>=», меньше или равно «<=») и выражения, допустимые в SQL.\n\n```sql\nSELECT title, price \nFROM book\nWHERE price < 600;\n```\n\n## Выборка данных, логические операции\n\nЛогическое выражение после ключевого слова WHERE кроме операторов сравнения  и выражений может включать  логические операции (И «and», ИЛИ «or», НЕ «not») и круглые скобки, изменяющие приоритеты выполнения операций.\n\nПриоритеты операций:\n1. круглые скобки\n2. умножение  (*),  деление (/)\n3. сложение  (+), вычитание (-)\n4. операторы сравнения (=, >, <, >=, <=, <>)\n5. NOT\n6. AND\n7. OR\n\n```sql\nSELECT title, author, price \nFROM book\nWHERE (author = 'Булгаков М.А.' OR author = 'Есенин С.А.') AND price > 600;\n```\n\nВ данном запросе обязательно нужно поставить скобки, так как без них сначала вычисляется  author = 'Есенин С.А.' and price > 600, а потом уже выражение через or. Без скобок были бы отобраны все книги Булгакова и те книги Есенина, цена которых больше 600.\n\n## Операторы BETWEEN, IN - выборка данных\n\nЛогическое выражение после ключевого слова WHERE может включать операторы  BETWEEN и IN. Приоритет  у этих операторов такой же как у операторов сравнения, то есть они выполняются раньше, чем NOT, AND, OR.\n\n### Оператор BETWEEN\nОператор BETWEEN позволяет отобрать данные, относящиеся к некоторому интервалу, включая его границы.\n\n```sql\nSELECT title, amount \nFROM book\nWHERE amount BETWEEN 5 AND 14;\n```\n\n### Оператор  IN\nОператор  IN  позволяет выбрать данные, соответствующие значениям из списка.\n\n```sql\nSELECT title, price \nFROM book\nWHERE author IN ('Булгаков М.А.', 'Достоевский Ф.М.');\n```\n\n## Оператор ORDER BY - выборка данных с сортировкой\n\nПри выборке можно указывать столбец или несколько столбцов, по которым необходимо отсортировать отобранные строки. Для этого используются ключевые слова ORDER BY, после которых задаются имена столбцов. При этом строки сортируются по первому столбцу, если указан второй столбец, сортировка осуществляется только для тех строк, у которых значения первого столбца одинаковы. По умолчанию ORDER BY выполняет сортировку по возрастанию. Чтобы управлять направлением сортировки вручную, после имени столбца указывается ключевое слово ASC (по возрастанию) или DESC (по убыванию). \n\nСтолбцы после ключевого слова ORDER BY можно задавать:\n- названием столбца;\n- номером столбца;\n- именем столбца (указанным после AS).\n\n```sql\nSELECT title, author, price\nFROM book\nORDER BY title;\n```\n\n## Оператор LIKE - выборка данных\nОператор LIKE используется для сравнения строк. В отличие от операторов отношения равно (=) и не равно (<>), LIKE позволяет сравнивать строки не на полное совпадение (не совпадение), а в соответствии с шаблоном. Шаблон может включать обычные символы и символы-шаблоны. При сравнении с шаблоном, его обычные символы должны в точности совпадать с символами, указанными в строке. Символы-шаблоны могут совпадать с произвольными элементами символьной строки.\n\n|Символ-шаблон|\tОписание|\tПример|\n|---|----|---|\n|%\t|Любая строка, содержащая ноль или более символов|\tSELECT * FROM book WHERE author LIKE '%М.%' - выполняет поиск и выдает все книги, инициалы авторов которых содержат «М.»|\n|_ (подчеркивание)|\tЛюбой одиночный символ|\tSELECT * FROM book WHERE title LIKE 'Поэм_' - выполняет поиск и выдает все книги, названия которых либо «Поэма», либо «Поэмы» и пр.|\n\n\n| Шаблон | Описание |\n| --- | --- |\n| 'Б%' | значение, начинающееся с буквы «Б». |\n| \"_ _ _ _ _\" | значение, состоящее ровно из 5 букв |\n| \"_ _ _ _ _ _%\" | значение  длиннее 5 символов |\n| title LIKE \"\\_% и \\_%\" _(отбирает слово И внутри названия)_ <br><br> OR title LIKE \"и \\_%\" _(отбирает слово И в начале названия)_ <br><br> OR title LIKE \"\\_% и\" _(отбирает слово И в конце названия)_ <br><br> OR title LIKE \"и\" | Значение которое содержит букву \"и\" как отдельное слово, если считать, что слова отделяются друг от друга пробелами и не содержат знаков препинания. |\n|\"% %\" | значение состоит ровно из одного слова|\n|\"_% %\" | значение состоит из двух и более слов |\n\n## Оператор DISTINCT - Выбор уникальных элементов столбца\n\nЧтобы отобрать уникальные элементы некоторого столбца используется ключевое слово DISTINCT, которое размещается сразу после SELECT.\n\n```sql\nSELECT DISTINCT author\nFROM book;\n```\n\n## Оператор GROUP BY - Выбор уникальных элементов столбца\n\nОператор GROUP BY группирует данные при выборке, имеющие одинаковые значения в некотором столбце. Столбец, по которому осуществляется группировка, указывается после GROUP BY .\n\nС помощью GROUP BY можно выбрать уникальные элементы столбца, по которому осуществляется группировка. Результат будет точно такой же как при использовании DISTINCT.\n\n```sql\nSELECT  author\nFROM book\nGROUP BY author;\n```\n\n## Групповые функции SUM и COUNT - Выборка данных\n\nПри группировке над элементами столбца, входящими в группу можно выполнить различные действия, например, просуммировать их или найти количество элементов в группе.\n\n```sql\nSELECT author, sum(amount), count(amount)\nFROM book\nGROUP BY author;\n```\n\n1. В таблице book определяются строки, в которых в столбце author одинаковые значения\n2. Вместо каждой группы в результирующий запрос включается  одна запись. Запись как минимум включает значение столбца, по которому осуществляется группировка (в нашем случае это author)\n3. Дальше можно выполнить вычисления над элементами КАЖДОЙ группы в отдельности, например, посчитать общее количество экземпляров книг каждого автора. Для этого используется групповая функция SUM(), а в скобках указывается столбец, по которому нужно выполнить суммирование ( в нашем случае amount)\n4. Также можно посчитать, сколько записей относится к группе. Для этого используется функция COUNT(), в скобках можно указать ЛЮБОЙ столбец из группы, если группа не содержит пустых значений (ниже приведен пример, в котором показано, как работает COUNT(), если в группе есть пустые значения)\n\nФункцию COUNT() можно применять к любому столбцу, в том числе можно использовать и *, если таблица не содержит пустых значений. Если же в столбцах есть значения Null, то\n- COUNT(*) —  подсчитывает  все записи, относящиеся к группе, в том числе и со значением NULL;\n- COUNT(имя_столбца) — возвращает количество записей конкретного столбца (только NOT NULL), относящихся к группе.\n\n## Групповые функции MIN, MAX и AVG\n\nК групповым функциям SQL относятся: MIN(), MAX() и AVG(), которые вычисляют минимальное, максимальное и среднее значение элементов столбца, относящихся к группе.\n\n```sql\nSELECT author, MIN(price) AS min_price\nFROM book\nGROUP BY author;\n```\n\n## Выборка данных c вычислением, групповые функции\n\nВ качестве аргумента групповых функций  SQL может использоваться не только столбец, но и любое допустимое в SQL арифметическое выражение.\n\n```sql\nSELECT author, SUM(price * amount) AS Стоимость\nFROM book\nGROUP BY author;\n```\n\n```\n+------------------+-----------+\n| author           | Стоимость |\n+------------------+-----------+\n| Булгаков М.А.    | 4715.47   |\n| Достоевский Ф.М. | 11802.03  |\n| Есенин С.А.      | 9750.00   |\n+------------------+-----------+\n```\n\n```sql\nSELECT author, ROUND(AVG(price),2) AS Средняя_цена\nFROM book\nGROUP BY author;\n```\n\n## Вычисления по таблице целиком\n\nГрупповые функции позволяют вычислять итоговые значения по всей таблице. Например, можно посчитать общее количество книг на складе, вычислить суммарную стоимость и пр. Для этого после ключевого слова SELECT указывается групповая функция для выражения или имени столбца, а ключевые слова GROUP BY опускаются.\n\n```sql\nSELECT SUM(amount) AS Количество\nFROM book;\n```\n\n## Выборка данных по условию, групповые функции\nВ запросы с групповыми функциями можно включать условие отбора строк, которое в обычных запросах записывается после WHERE. В запросах с групповыми функциями вместо WHERE используется ключевое слово HAVING , которое размещается после оператора GROUP BY.\n\n```sql\nSELECT author,\n    MIN(price) AS Минимальная_цена, \n    MAX(price) AS Максимальная_цена\nFROM book\nGROUP BY author\nHAVING SUM(price * amount) > 5000; \n```\n\nТакже в запросах с группировкой можно сортировать данные.\n\n```sql\nSELECT author,\n    MIN(price) AS Минимальная_цена, \n    MAX(price) AS Максимальная_цена\nFROM book\nGROUP BY author\nHAVING SUM(price * amount) > 5000 \nORDER BY Минимальная_цена DESC;\n```\n\nWHERE и HAVING могут использоваться в одном запросе. При этом необходимо учитывать порядок выполнения  SQL запроса на выборку на СЕРВЕРЕ:\n\nFROM\nWHERE\nGROUP BY\nHAVING\nSELECT\nORDER BY\n","description":"Базовые запросы с использованием LIKE, BETWEEN, ORDER BY, ALIASES, IN, TOP-LIMIT, DISTINCT","image":"null","category":{"id":"testops","title":"testops","path":"/category/testops/"},"date":"07/07/2022","path":"/bazovye-zaprosy-s-ispolzovaniem-like-between-order-by-aliases-in-top-limit-distinct/","links":[{"title":"","items":[{"title":"CREATE, DROP, DELETE, UPDATE, INSERT, ALTER","link":"/create-drop-delete-update-insert-alter"},{"title":"Базовые запросы с использованием LIKE, BETWEEN, ORDER BY, ALIASES, IN, TOP-LIMIT, DISTINCT","link":"/bazovye-zaprosy-s-ispolzovaniem-like-between-order-by-aliases-in-top-limit-distinct"}]}],"headings":[{"value":"Выборка всех данных из таблицы","anchor":"#выборка-всех-данных-из-таблицы"},{"value":"Выборка отдельных столбцов","anchor":"#выборка-отдельных-столбцов"},{"value":"AS - Выборка новых столбцов и присвоение им новых имен","anchor":"#as---выборка-новых-столбцов-и-присвоение-им-новых-имен"},{"value":"Выборка данных, вычисляемые столбцы, математические функции","anchor":"#выборка-данных-вычисляемые-столбцы-математические-функции"},{"value":"Выборка данных, вычисляемые столбцы, логические функции","anchor":"#выборка-данных-вычисляемые-столбцы-логические-функции"},{"value":"Выборка данных по условию","anchor":"#выборка-данных-по-условию"},{"value":"Выборка данных, логические операции","anchor":"#выборка-данных-логические-операции"},{"value":"Операторы BETWEEN, IN - выборка данных","anchor":"#операторы-between-in---выборка-данных"},{"value":"Оператор ORDER BY - выборка данных с сортировкой","anchor":"#оператор-order-by---выборка-данных-с-сортировкой"},{"value":"Оператор LIKE - выборка данных","anchor":"#оператор-like---выборка-данных"},{"value":"Оператор DISTINCT - Выбор уникальных элементов столбца","anchor":"#оператор-distinct---выбор-уникальных-элементов-столбца"},{"value":"Оператор GROUP BY - Выбор уникальных элементов столбца","anchor":"#оператор-group-by---выбор-уникальных-элементов-столбца"},{"value":"Групповые функции SUM и COUNT - Выборка данных","anchor":"#групповые-функции-sum-и-count---выборка-данных"},{"value":"Групповые функции MIN, MAX и AVG","anchor":"#групповые-функции-min-max-и-avg"},{"value":"Выборка данных c вычислением, групповые функции","anchor":"#выборка-данных-c-вычислением-групповые-функции"},{"value":"Вычисления по таблице целиком","anchor":"#вычисления-по-таблице-целиком"},{"value":"Выборка данных по условию, групповые функции","anchor":"#выборка-данных-по-условию-групповые-функции"}],"subtitles":[{"depth":2,"value":"Выборка всех данных из таблицы","anchor":"#выборка-всех-данных-из-таблицы"},{"depth":2,"value":"Выборка отдельных столбцов","anchor":"#выборка-отдельных-столбцов"},{"depth":2,"value":"AS - Выборка новых столбцов и присвоение им новых имен","anchor":"#as---выборка-новых-столбцов-и-присвоение-им-новых-имен"},{"depth":2,"value":"Выборка данных, вычисляемые столбцы, математические функции","anchor":"#выборка-данных-вычисляемые-столбцы-математические-функции"},{"depth":2,"value":"Выборка данных, вычисляемые столбцы, логические функции","anchor":"#выборка-данных-вычисляемые-столбцы-логические-функции"},{"depth":2,"value":"Выборка данных по условию","anchor":"#выборка-данных-по-условию"},{"depth":2,"value":"Выборка данных, логические операции","anchor":"#выборка-данных-логические-операции"},{"depth":2,"value":"Операторы BETWEEN, IN - выборка данных","anchor":"#операторы-between-in---выборка-данных"},{"depth":3,"value":"Оператор BETWEEN","anchor":"#оператор-between"},{"depth":3,"value":"Оператор  IN","anchor":"#оператор--in"},{"depth":2,"value":"Оператор ORDER BY - выборка данных с сортировкой","anchor":"#оператор-order-by---выборка-данных-с-сортировкой"},{"depth":2,"value":"Оператор LIKE - выборка данных","anchor":"#оператор-like---выборка-данных"},{"depth":2,"value":"Оператор DISTINCT - Выбор уникальных элементов столбца","anchor":"#оператор-distinct---выбор-уникальных-элементов-столбца"},{"depth":2,"value":"Оператор GROUP BY - Выбор уникальных элементов столбца","anchor":"#оператор-group-by---выбор-уникальных-элементов-столбца"},{"depth":2,"value":"Групповые функции SUM и COUNT - Выборка данных","anchor":"#групповые-функции-sum-и-count---выборка-данных"},{"depth":2,"value":"Групповые функции MIN, MAX и AVG","anchor":"#групповые-функции-min-max-и-avg"},{"depth":2,"value":"Выборка данных c вычислением, групповые функции","anchor":"#выборка-данных-c-вычислением-групповые-функции"},{"depth":2,"value":"Вычисления по таблице целиком","anchor":"#вычисления-по-таблице-целиком"},{"depth":2,"value":"Выборка данных по условию, групповые функции","anchor":"#выборка-данных-по-условию-групповые-функции"}],"tags":[{"id":"qa","title":"qa","path":"/tag/qa/"}]},"comments":{"edges":[]}},"context":{}}